# Generating API Tokens 

## Generating API Tokens to set up continuous profile collection (Parca Agent)

An agent set up through use of the Parca Agent can be configured to continuously send profiles to Polar Signals. In order to set up the Parca Agent on a Kubernetes cluster, the user must first create an API Token in the Polar Signals UI.

## Generating an API Token

The first step in setting up an agent with Parca Agent on a Kubernetes cluster is to generate an API token for the given project you are working on. This token can be generated by heading to the “Settings” page of that project.

<BrowserWindow>

![Project settings link](/img/project-settings.png)

</BrowserWindow>

In the API Tokens section, enter a name for the token that will be generated and click “Create token”.

<BrowserWindow>

![Create token button](/img/create-token-button.png)

</BrowserWindow>

Upon successful creation, the contents of the token will appear in the text box below. This value can be copied simply by clicking on the text box. The token is only shown one time, so make sure to copy and save it in a secure location.

<BrowserWindow>

![Token generated successfully](/img/token-generated-jwt.png)

</BrowserWindow>

A record of each of the tokens that have been created will appear in the table below the text box. If necessary, tokens can be deactivated by hitting the “Delete” button.

Note: The token created through the Polar Signals UI is a [JSON Web Token](https://jwt.io/) (JWT). JWT is a secure way to send information between parties as a JSON object. The token contains multiple pieces of information to authenticate and validate the user, including the project id. This ensures that the profiles sent using the Parca Agent configured with this token can be stored in the correct location. Full contents of the token can be viewed on [jwt.io](https://jwt.io/).

## Using the generated token to set up a Parca Agent

The Parca Agent is an always-on sampling profiler used to capture raw profiling data. It can discover targets to profile through Kubernetes or systemd. When set up on a Kubernetes node, the Parca Agent can discover containers in that node and continuously send profiles from these containers to the Polar Signals cloud. Similarly, when set up using systemd, the Parca Agent can discover systemd units on the node the agent is running on.

The following command can be run to set up the Parca Agent through systemd. The token generated in the steps above should be provided in the command following the `--bearer-token` flag, as can be seen in the example below.

```bash
sudo dist/parca-agent --node=test --log-level=debug --kubernetes=false --insecure --systemd-units=docker-b8873e261a9fb63e83d3d865a8780066e12e55b2f7eb8f6ac87db0b08444c6a8.scope --bearer-token eyJhbGciOiJFZERTQSJ9.eyJhdWQiOiI2ZmJiNjQwMy0yMDNkLTRhYjEtYjQ4Yy02ZGZiZmM2N2E2NzkiLCJpYXQiOjE2NTIzNTAxNzYwMzk4ODU0MDMsImlzcyI6Imh0dHBzOi8vYXBpLnBvbGFyc2lnbmFscy5jb20vIiwianRpIjoiNTdhYmJjZDAtNjdjNS00Y2Q2LWFlNmQtMTIxZTNkNjA5MTdhIiwicHJvamVjdElkIjoiNmZiYjY0MDMtMjAzZC00YWIxLWI0OGMtNmRmYmZjNjdhNjc5IiwidmVyc2lvbiI6IjEuMC4wIiwid3JpdGVQcm9maWxlcyI6dHJ1ZX0.OW16Shc4B48EW5TfYP9rggC7Pw9anu3yFd_vOoMqg2cwypBTlCDTOVvu6XtjNurxCUTJz24xXlzoS_Gyt18DAQ
```

Upon successful execution of this command, the agent should be set up to capture profiles and send them to the Polar Signals cloud. For more information on the [Parca Agent](https://www.parca.dev/docs/parca-agent) and how to explore collected data, see here: [Kubernetes](https://www.parca.dev/docs/kubernetes), [systemd](https://www.parca.dev/docs/systemd).
